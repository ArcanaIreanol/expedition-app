<dom-module id="roleplay-card">
  <template>
    <!-- Ideas: http://www.trollmystic.com/pub/2012/03/03/event-generator/ -->
    <expedition-card-set id="pages" initial="intro" title="Guided Adventure" on-return="roleplayEnd">
      <expedition-card
        id="intro"
        title="Guided Adventure"
        icon="cards"
        data-route="intro">
        <tutorial-dialog id="tutorial_guide" section="guide"></tutorial-dialog>

        <p>
          The Guided Adventure mode helps you tell fun and engaging quests. Your Guide should use it to prepare a quest ahead of time (15-30 minutes) or to help direct the quest on the fly.
        </p>

        <p>
          As a Guide, you will:
        </p>
        <ul>
          <li>Build a world from scratch
          <li>Describe your party's history
          <li>Trigger an epic quest
          <li>Surprise your party
          <li>Force the party into a difficult decision
          <li>Have them overcome a great task
          <li>Bring the story to full closure
        </ul>

        <p>
          Let's get started!
        </p>

        <paper-button on-tap="next" data-target="stasis">Next</paper-button>
      </expedition-card>

      <expedition-card
        id="stasis"
        title="Stasis"
        icon="adventurer"
        data-route="stasis"
        on-return="return">
        <tutorial-dialog title="Open Rules" id="tutorial_openrules" section="openrules"></tutorial-dialog>

        <p>
          Every story should start with stasis: everyday life, the status quo. Describe what is, so that change can occur.
        </p>

        <strong>Build a World</strong>
        <div>
          Describe the realm around your party, and provide a bit of lore. They could be:
        </div>

        <ul>
          <li>In the capital city of the realm, which is undergoing a cultural shift.
          <li>Outside a small settlement on the border of two warring factions.
          <li>Trapped in a dungeon owned by a long-dead king.
        </ul>

        <strong>Relationships</strong>
        <div>
          Choose a relationship for your party:
        </div>

        <ul>
          <li><strong>Unexpected Allies</strong> - Strangers at the start, the trigger brings you together.
          <li><strong>Assembled</strong> - Paid (or "volunteered") by someone to do a specific job, your party begins with little camaraderie.
          <li><strong>Rivals</strong> - Perhaps a feud, or perhaps fighting for a shared desire, you begin as enemies or rivals.
          <li><strong>Friends &amp; Family</strong> - You've known each other for a long time, but the trials ahead will test your friendships to the limit.
        </ul>

        <strong>Backstory</strong>
        <div>
          Each player should now give a brief, improvized backstory for their character.
        </div>

        <div>
          When finished, you'll start your journey by choosing a trigger.
        </div>

        <paper-button on-tap="next" data-target="triggers">Next: Choose a trigger</paper-button>
      </expedition-card>
      <expedition-card
        id="triggers"
        title="Triggers"
        icon="damage"
        data-route="triggers"
        on-return="return">

        <p>
          Choose a way to start your journey:
        </p>

        <ul>
          <li><strong>Corruption</strong> - Addiction, illness, or a vice of the mind plagues your party or a major character in your world - you must find a way to fix this before it's too late.
          <li><strong>Wrongdoing</strong> - Corruption, lawlessness, or an evil ambition spawns a search for justice or revenge.
          <li><strong>Mischief</strong> - One or more of your party or an outside trickster gets up to no good, landing you in the thick of things.
          <li><strong>Wanderlust</strong> - A quest of curiosity or a desire for glory sends your party abroad.
          <li><strong>Theft</strong> - Someone takes something that's vital to your party - material or immaterial. You must begin the chase to reclaim what is yours.
          <li><strong>Terror</strong> - Your party faces unspeakable horror, loss, or insanity and must cope with a world forever changed.
        </ul>

        <div>
          When your party has begun adventuring, tap Next to throw some suprises their way.
        </div>

        <paper-button on-tap="next" data-target="encounter">Begin Encounter</paper-button>
        <paper-button on-tap="next" data-target="surprises">Next: Surprises</paper-button>
      </expedition-card>
      <expedition-card
        id="surprises"
        title="Surprises"
        icon="melee"
        data-route="surprises"
        on-return="return">

        <p>
          Use one or more of these twists to spice up your story:
        </p>

        <ul>
          <li><strong>Broken Ranks</strong> - Circumstance causes your party to split - a boulder seals the passage, a disagreement occurs, or something else entirely.
          <li><strong>Big Guy</strong> - A big baddie blocks your party's path... and he's brought some friends.
          <li><strong>The Device</strong> - You discover a complex, heartless construct fashioned by negligence or ill intent.
          <li><strong>Switched</strong> - Something cute that's actually evil; an enemy becomes an ally (or do they?);
          <li><strong>Subterfuge</strong> - Snoop or be snooped - you witness something that you shouldn't have, or notice someone or something incognito.
          <li><strong>A New Lead</strong> - Unexpected appearance by a wise man or long-lost friend, written prophecy, or acute observance offers a fresh clue for your party.
          <li><strong>Character Assassination</strong> - Figuratively or literally, a character in your story is put down.
          <li><strong>Who's the Monster?</strong> - Your party's righteous act was actually against an innocent group.
          <li><strong>A Milk Run</strong> - In the midst of an easy task, something unexpected and highly improbable happens or goes wrong.
          <li><strong>Change the Rules</strong> - Have fewer days to do the job, less loot, or a new requirement before the climax.
        </ul>

        <div>
          When you're about halfway into your story, tap Next to present your party with a critical choice.
        </div>

        <paper-button on-tap="next" data-target="encounter">Begin Encounter</paper-button>
        <paper-button on-tap="next" data-target="choices">Next: The Critical Choice</paper-button>
      </expedition-card>
      <expedition-card
        id="choices"
        title="Critical Choices"
        icon="d20"
        data-route="choices"
        on-return="return">

        <p>
          Your party must choose their path:
        </p>

        <ul>
          <li><strong>At Their Mercy</strong> - Your party is in the clutches of something greater, and must escape or succumb.
          <li><strong>Picking Sides</strong> - Choose between whom to save, or perhaps which enemy to attack.
          <li><strong>Abomination</strong> - Something absolutely abhorrent is revealed. Your party must come to terms with this discovery.
        </ul>

        <div>
          When the decision has been made, tap Next to steer your party to the story's climax.
        </div>

        <paper-button on-tap="next" data-target="encounter">Begin Encounter</paper-button>
        <paper-button on-tap="next" data-target="climax">Next: Climax</paper-button>
      </expedition-card>
      <expedition-card
        id="climax"
        title="Climax"
        icon="beast"
        data-route="climax"
        on-return="return">

        <p>
          Choose how your party faces their ultimate challenge:
        </p>

        <ul>
          <li><strong>Imminent Doom</strong> - You discover something in the environment which, if allowed to continue for much longer, will mean the end for your party and beyond.
          <li><strong>Showdown</strong> - Go head-to-head with your villain, in a battle of wits or weapons.
          <li><strong>Hold the Line</strong> - Fight back waves of opponents until the plan comes to fruition.
          <li><strong>Relic and Ritual</strong> - You find what you're looking for, or accomplish the task - which brings a storm of conflict.
        </ul>

        <div>
          When the party has overcome the challenge, tap Next to move on to the resolution.
        </div>

        <paper-button on-tap="next" data-target="encounter">Begin Encounter</paper-button>
        <paper-button on-tap="next" data-target="resolution">Next: Resolution</paper-button>
      </expedition-card>
      <expedition-card
        id="resolution"
        title="Resolution"
        icon="music"
        data-route="resolution"
        on-return="return">

        <p>
          Wrap up your story and describe how the party's world has changed.
        </p>

        <ul>
          <li><strong>Cruel Twist</strong> - The party's actions cause an excessively cruel act that ends the story. Evil is stopped with liberal application of evil, or a malign deed improves the world.
          <li><strong>Bittersweet</strong> - A pyrrhic victory for your friends - innocence and friends are lost, great sacrifices made, or evil merely delayed for now.
          <li><strong>Closure</strong> - You return to stasis and recover, more knowledgeable from the ordeal.
          <li><strong>Residue</strong> - Everything is back to normal. Well, mostly.
        </ul>

        <paper-button on-tap="next" data-target="encounter">Begin Encounter</paper-button>
        <paper-button on-tap="_onRoleplayEnd">To Menu</paper-button>
      </expedition-card>

      <combat-card
        id="encounter"
        on-return="_onCombatEnd"
        data-route="encounter" custom>
      </combat-card>

    </expedition-card-set>
  </template>
  <script>
    Polymer({
      is: 'roleplay-card',
      ready: function() {
        this.$.pages.next('intro');
        this._route = null;
        this._bookmark = null;
      },
      next: function(e) {
        var target = e.currentTarget.dataset.target;
        if (target === "encounter") {
          this.$.encounter.ready();
          this._bookmark = this._route;
        } else {
          this._route = e.currentTarget.dataset.target;
        }
        this.$.pages.next(target, e.currentTarget.dataset.anim);
      },
      return: function(e) {
        var p = Polymer.dom(e.srcElement).previousSibling;
        while (p.tagName !== "EXPEDITION-CARD") {
          p = p.previousSibling;
        }
        this.$.pages.prev(p.dataset.route);
        this._route = p.dataset.route;
        e.stopPropagation();
      },
      _onCombatEnd: function(e) {
        this.$.pages.prev(this._bookmark);
        this._bookmark = null;
        e.stopPropagation();
      },
      _onRoleplayEnd: function(e) {
        this.$.pages.reset();
        this._route = null;
        this._bookmark = null;
        e.stopPropagation();
        this.fire('return');
      },
    });
  </script>

</dom-module>
